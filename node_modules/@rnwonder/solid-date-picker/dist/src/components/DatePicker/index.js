import { use as Xe, insert as S, createComponent as f, mergeProps as V, memo as Pe, effect as Re, className as me, style as Be, template as be } from "solid-js/web";
import { createSignal as w, onMount as Ne, createEffect as ye, Show as k } from "solid-js";
import { CalendarArea as Ee } from "../CalendarArea/index.js";
import { DatePickerTop as Ie } from "../DatePickerTop/index.js";
import He from "../SelectorTwo/index.js";
import { convertDateObjectToDate as z, convertDateToDateObject as pe } from "../../utils/format.js";
import { currentYear as ve, getDatePickerRefactoredMonth as L, getDatePickerRefactoredYear as Ve, getOnChangeSingleData as ze } from "../../utils/generate.js";
import { handleDateRange as De } from "../../utils/action.js";
import { compareObjectDate as fe } from "../../utils/general.js";
import { cn as we } from "../../utils/class.js";
var Se = be("<div data-type=custom-jsx>"), Le = be("<div data-type=date-picker-wrapper data-scope=date-picker data-part=content role=application aria-label=calendar aria-roledescription=date-picker><div>");
const et = (e) => {
  const [b, p] = w((/* @__PURE__ */ new Date()).getMonth()), [O, v] = w(ve), [M, T] = w(), [J, W] = w(void 0), [j, E] = w([]), [q, X] = w(!0), [Me, G] = w(!1), [x, C] = w({});
  Ne(() => {
    var t, r, n, s, l, u, c, i, A, F, m, h, y, B, d, ee, te, re, ae, ne, oe, le, se, ce, ue, ie, he;
    if (!((t = e.value) != null && t.selected || (r = e.value) != null && r.start || (n = e.value) != null && n.end || (s = e.value) != null && s.selectedDateObject || (l = e.value) != null && l.startDateObject || (u = e.value) != null && u.endDateObject || (c = e.value) != null && c.multiple || (A = (i = e.value) == null ? void 0 : i.multipleDateObject) != null && A.length))
      return (F = e.month) != null && F.call(e) || ((m = e.setMonth) == null || m.call(e, (/* @__PURE__ */ new Date()).getMonth())), (h = e.year) != null && h.call(e) || ((y = e.setYear) == null || y.call(e, ve)), void K();
    if (K(), G(!0), e.value.selected || e.value.selectedDateObject) {
      const o = e.value.selected ? new Date(e.value.selected) : z(e.value.selectedDateObject);
      p(o.getMonth()), (B = e.setMonth) == null || B.call(e, o.getMonth()), v(o.getFullYear()), (d = e.setYear) == null || d.call(e, o.getFullYear()), T({ year: o.getFullYear(), month: o.getMonth(), day: o.getDate() });
    }
    if (e.value.start || e.value.end || e.value.startDateObject || e.value.endDateObject) {
      const o = e.value.start ? new Date(e.value.start) : (ee = e.value.startDateObject) != null && ee.day ? z(e.value.startDateObject) : void 0, a = e.value.end ? new Date(e.value.end) : (te = e.value.endDateObject) != null && te.day ? z(e.value.endDateObject) : void 0;
      if (!o && !a)
        return;
      if (!o && a) {
        p(a.getMonth()), (re = e.setMonth) == null || re.call(e, a.getMonth()), v(a.getFullYear()), (ae = e.setYear) == null || ae.call(e, a.getFullYear());
        const ge = { year: a.getFullYear(), month: a.getMonth(), day: a.getDate() };
        return T(ge), void C({ start: ge });
      }
      p(o.getMonth()), (ne = e.setMonth) == null || ne.call(e, o.getMonth()), v(o.getFullYear()), (oe = e.setYear) == null || oe.call(e, o.getFullYear());
      const N = { year: o.getFullYear(), month: o.getMonth(), day: o.getDate() };
      if (T(N), C({ start: N }), !a)
        return;
      W({ year: a.getFullYear(), month: a.getMonth(), day: a.getDate() }), C({ start: void 0 }), e.showEndOfRange && (p(a.getMonth()), (le = e.setMonth) == null || le.call(e, a.getMonth()), v(a.getFullYear()), (se = e.setYear) == null || se.call(e, a.getFullYear()));
    }
    if ((ce = e.value.multipleDateObject) != null && ce.length || e.value.multiple) {
      const o = (ue = e.value.multipleDateObject) != null && ue.length ? e.value.multipleDateObject : e.value.multiple ? e.value.multiple.map((N) => pe(new Date(N))) : void 0;
      if (!o)
        return;
      E(o);
      const a = o.at(-1);
      a != null && a.month && (p(a.month), (ie = e.setMonth) == null || ie.call(e, a.month)), a != null && a.year && (v(a.year), (he = e.setYear) == null || he.call(e, a.year));
    }
  });
  const P = (t) => {
    var r, n;
    e.handleOnChange(t), (r = e == null ? void 0 : e.onChange) == null || r.call(e, t), (n = e.onValueChange) == null || n.call(e, t);
  }, K = () => {
    var t, r;
    e.startingMonth && p(e.startingMonth), e.startingMonth && ((t = e.setMonth) == null || t.call(e, e.startingMonth)), e.startingYear && v(e.startingYear), e.startingYear && ((r = e.setYear) == null || r.call(e, e.startingYear));
  };
  ye(() => {
    q() || X(!0);
  });
  const Q = (t, r, n, s = !1) => {
    var i, A, F;
    Me() || G(!0);
    const l = Number(r()), u = L(l, t.month), c = Ve(n(), r(), t.month);
    if (e.type === "range") {
      const { end: m, start: h, initial: y } = De({ day: t, month: r, year: n, endDay: J(), startDay: M(), disabledDays: e.disabledDays, enabledDays: e.enabledDays });
      T(h), W(m), y && !e.disableRangeHoverEffect && C({ start: h, end: void 0 }), m && h && C({}), P({ startDate: h, endDate: m, type: "range" });
    }
    if (e.type === "single") {
      const m = new Date(c, L(l, t.month), t.value), h = pe(m);
      T(h), P({ selectedDate: h, type: "single" });
    }
    if (e.type === "multiple") {
      const m = { year: c, month: L(l, t.month), day: t.value }, h = j().find((y) => fe(y, m));
      if (h) {
        const y = j().filter((B) => !fe(B, h));
        return E(y), void P({ multipleDates: y, type: "multiple" });
      }
      E((y) => [...y, m]), P({ multipleDates: j(), type: "multiple" });
    }
    s || (p(u), (i = e.setMonth) == null || i.call(e, u), v(c), (A = e.setYear) == null || A.call(e, c)), X(!1), e.shouldCloseOnSelect && ((F = e.close) == null || F.call(e));
  }, R = (t, r) => {
    var s, l, u, c, i;
    p(t), (s = e.setMonth) == null || s.call(e, t), (l = e.onMonthChange) == null || l.call(e, t), r && (v(r), (u = e.setYear) == null || u.call(e, r), (c = e.onYearChange) == null || c.call(e, r));
    const n = ze({ startDay: M(), month: t, year: r, type: e.type });
    n && ((i = e.onValueChange) == null || i.call(e, n));
  }, U = () => {
    var r, n;
    if ((((r = e.month) == null ? void 0 : r.call(e)) || b()) === 11) {
      const l = O() + 1;
      return void R(0, l);
    }
    const t = (((n = e.month) == null ? void 0 : n.call(e)) || b()) + 1;
    R(t), X(!1);
  }, Z = () => {
    var r, n;
    if ((((r = e.month) == null ? void 0 : r.call(e)) || b()) === 0) {
      const l = O() - 1;
      return void R(11, l);
    }
    const t = (((n = e.month) == null ? void 0 : n.call(e)) || b()) - 1;
    R(t), X(!1);
  }, Ce = (t, r, n) => {
    var u, c, i;
    if (e.disableRangeHoverEffect || e.type !== "range" || !((u = x()) != null && u.start))
      return;
    const { end: s, start: l } = De({ day: t, month: r, year: n, endDay: (c = x()) == null ? void 0 : c.end, startDay: (i = x()) == null ? void 0 : i.start, disabledDays: e.disabledDays, hover: !0, enabledDays: e.enabledDays });
    C({ start: l, end: s });
  }, Ye = () => {
    var t;
    e.disableRangeHoverEffect || e.type === "range" && ((t = x()) != null && t.start) && (M() && J() || C({ start: M(), end: void 0 }));
  }, g = (t) => {
    if (t) {
      if (typeof t == "function") {
        const [s, l] = w();
        ye(() => {
          var c;
          s() && ((c = e.setAllowedComponents) == null || c.call(e, (i) => [...i, s()]));
        });
        const u = t({ month: b, setMonth: p, handleNextMonth: U, handlePrevMonth: Z, year: O, setYear: v, setRefToAllowOutsideClick: l, handleDayClick: Q, multipleDates: j, endDate: J, selectedDate: M });
        return r = Se(), S(r, u), r;
      }
      var r, n;
      return n = Se(), S(n, t), n;
    }
  }, Te = g(e.monthSelectorJSX), ke = g(e.yearSelectorJSX), Oe = g(e.calendarTopAreaJSX), I = g(e.calendarLeftAreaJSX), H = g(e.calendarRightAreaJSX), _ = g(e.calendarBottomAreaJSX), je = g(e.calendarJSX), xe = g(e.afterNextButtonAreaJSX), Ae = g(e.beforePrevButtonAreaJSX), Fe = g(e.weekDaysJSX), Je = g(e.calendarAboveTopAreaJSX);
  return D = Le(), Y = D.firstChild, typeof ($ = e.ref) == "function" ? Xe($, D) : e.ref = D, S(D, f(k, { get when() {
    var t;
    return (t = e.showSelectorTwo) == null ? void 0 : t.call(e);
  }, get children() {
    return f(He, V(() => {
      var t;
      return (t = e.selectorTwoProps) == null ? void 0 : t.call(e);
    }, { get setShowSelectorTwo() {
      return e.setShowSelectorTwo;
    }, get setSelectorTwoProps() {
      return e.setSelectorTwoProps;
    } }));
  } }), Y), S(D, f(k, { get when() {
    return !e.hideTopArea;
  }, keyed: !0, get children() {
    return [Je, Pe(() => Oe || f(Ie, V(() => ({ ...e, onChange: void 0 }), { get setYear() {
      return e.setYear || v;
    }, get setMonth() {
      return e.setMonth || p;
    }, get month() {
      return e.month || b;
    }, get year() {
      return e.year || O;
    }, render: q, handleNextMonth: U, handlePrevMonth: Z, monthSelectorJSX: Te, yearSelectorJSX: ke, get zIndex() {
      return e.zIndex;
    }, get setAllowedComponents() {
      return e.setAllowedComponents;
    }, get monthSelectorFormat() {
      return e.monthSelectorFormat;
    }, get monthYearSelectorFlexDirection() {
      return e.monthYearSelectorFlexDirection;
    }, get onChange() {
      return e.onValueChange;
    }, get startDay() {
      return M();
    }, setStartDay: T, get yearRange() {
      return e.yearRange;
    }, get locale() {
      return e.locale;
    }, get nextIcon() {
      return e.nextIcon;
    }, get prevIcon() {
      return e.prevIcon;
    }, get removeNavButtons() {
      return e.removeNavButtons;
    }, nextButtonAreaJSX: xe, prevButtonAreaJSX: Ae, get primaryColor() {
      return e.primaryColor;
    }, get primaryTextColor() {
      return e.primaryTextColor;
    }, get secondaryColor() {
      return e.secondaryColor;
    }, get secondaryTextColor() {
      return e.secondaryTextColor;
    }, get setShowSelectorTwo() {
      return e.setShowSelectorTwo;
    }, get setSelectorTwoProps() {
      return e.setSelectorTwoProps;
    }, get showSelectorTwo() {
      return e.showSelectorTwo;
    } })))];
  } }), Y), S(Y, f(k, { get when() {
    var t;
    return I && !((t = e.showSelectorTwo) != null && t.call(e));
  }, keyed: !0, children: I }), null), S(Y, f(k, { get when() {
    return !e.hideCalendar;
  }, keyed: !0, get children() {
    return je || f(Ee, V(e, { get year() {
      return e.year || O;
    }, get month() {
      return e.month || b;
    }, endDay: J, startDay: M, handleDayClick: Q, multipleObject: j, weekDaysJSX: Fe, onHoverDay: Ce, hoverRangeValue: x, onHoverDayEnd: Ye, get showSelectorTwo() {
      return e.showSelectorTwo;
    } }));
  } }), null), S(Y, f(k, { get when() {
    var t;
    return H && !((t = e.showSelectorTwo) != null && t.call(e));
  }, keyed: !0, children: H }), null), S(D, f(k, { get when() {
    var t;
    return _ && !((t = e.showSelectorTwo) != null && t.call(e));
  }, keyed: !0, children: _ }), null), Re((t) => {
    var l;
    var r = we(`date-picker-wrapper 
          rn-relative 
          rn-rounded-md 
          rn-border-t 
          rn-border-solid
          rn-border-gray-300
          rn-bg-white
          rn-pb-[0.5rem] 
          rn-pt-[0.625rem] 
          dark:rn-border-gray-700
          dark:rn-bg-dreamless-sleep
          `, { "rn-w-max": !I && !H, "rn-shadow-lg": !((l = e.showSelectorTwo) != null && l.call(e)) }, e.datePickerWrapperClass), n = { ...e.backgroundColor && { "background-color": e.backgroundColor } }, s = we("date-picker-body rn-flex rn-justify-center", e.datePickerBodyAreaClass);
    return r !== t.e && me(D, t.e = r), t.t = Be(D, n, t.t), s !== t.a && me(Y, t.a = s), t;
  }, { e: void 0, t: void 0, a: void 0 }), D;
  var D, Y, $;
};
export {
  et as DatePicker
};
