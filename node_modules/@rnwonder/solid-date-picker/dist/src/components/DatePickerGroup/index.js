import { createComponent as h, mergeProps as O, setAttribute as W, insert as k, spread as $, template as j } from "solid-js/web";
import { createSignal as m, Show as I } from "solid-js";
import { DatePicker as z } from "../DatePicker/index.js";
import { Popover as B } from "../Popover/index.js";
import { createButtonAnimation as E } from "../../hooks/createButtonAnimation.js";
import { defaultSelectorProps as C } from "../SelectorTwo/index.js";
import { convertDateObjectToDate as p, labelFormat as c } from "../../utils/format.js";
import { cn as P } from "../../utils/class.js";
var X = j('<input readonly type=text data-scope=date-picker data-part=input aria-label="date picker input"data-type=date-picker-input>'), G = j("<div class=date-picker-input-area data-scope=date-picker data-part=control>");
const U = (e) => {
  const [d, x] = m({ label: "", value: {} }), [L, S] = m(!1), [R, v] = m([]), [T, D] = m(!1), [Y, b] = m(C);
  E(e.noButtonAnimation);
  const A = (t) => {
    const l = e.value || d, o = e.setValue || x;
    if (t.type === "single") {
      const a = p((t == null ? void 0 : t.selectedDate) || {}), r = c({ date: a, option: (e == null ? void 0 : e.localeOptions) || { month: "short", day: "numeric", year: "numeric" }, format: e.formatInputLabel, locale: e.locale });
      o({ value: { selected: (a == null ? void 0 : a.toISOString()) || "", selectedDateObject: (t == null ? void 0 : t.selectedDate) || {} }, label: r });
    }
    if (t.type === "range") {
      const a = t.startDate ? p(t.startDate) : void 0, r = t.endDate ? p(t.endDate) : void 0;
      let f = "";
      const i = { month: "short", day: "numeric", year: "numeric", ...(e == null ? void 0 : e.localeOptions) || {}, ...e != null && e.alwaysShowRangeStartYear ? {} : { year: void 0 } }, s = (e == null ? void 0 : e.localeOptions) || { month: "short", day: "numeric", year: "numeric" };
      let u = "", n = "";
      if (a && r) {
        if (a.getFullYear() === r.getFullYear()) {
          if (e.alwaysShowRangeStartYear)
            return;
          i.year = void 0;
        } else
          i.year = "numeric";
        u = c({ date: a, option: i, format: e.formatInputLabelRangeStart, locale: e.locale }), n = c({ date: r, option: s, format: e.formatInputLabelRangeEnd, locale: e.locale });
      }
      a && !r && (u = c({ date: a, option: i, format: e.formatInputLabelRangeStart, locale: e.locale })), !a && r && (n = c({ date: r, option: s, format: e.formatInputLabelRangeEnd, locale: e.locale })), f = `${u} ${e.rangeDatesSeparator || "-"} ${n}`, o({ value: { start: (a == null ? void 0 : a.toISOString()) || "", startDateObject: (t == null ? void 0 : t.startDate) || {}, end: (r == null ? void 0 : r.toISOString()) || "", endDateObject: (t == null ? void 0 : t.endDate) || {} }, label: f });
    }
    if (t.type === "multiple") {
      const a = l().value.multipleDateObject || [], r = t.multipleDates || [];
      if (!l().label && r.length === 0 || a.toString() === r.toString() && l().label)
        return;
      const f = r.map((i) => {
        const s = p(i);
        return c({ date: s, option: (e == null ? void 0 : e.localeOptions) || { month: "short", day: "numeric", year: "numeric" }, format: e.formatInputLabel, locale: e.locale });
      });
      o({ value: { multiple: r.map((i) => {
        var s;
        return ((s = p(i)) == null ? void 0 : s.toISOString()) || "";
      }).sort((i, s) => i.localeCompare(s)), multipleDateObject: r.sort((i, s) => {
        var y, w;
        const u = ((y = p(i)) == null ? void 0 : y.toISOString()) || "", n = ((w = p(s)) == null ? void 0 : w.toISOString()) || "";
        return u.localeCompare(n);
      }) }, label: f.join(e.multipleDatesSeparator || ", ") });
    }
  }, F = () => {
    S(!0);
  }, g = ((t) => {
    if (t)
      return typeof t == "function" ? t({ value: e.value || d, showDate: F }) : t;
  })(e.renderInput);
  return h(B, { get isShown() {
    return L();
  }, setIsShown: S, onClose: () => {
    var t;
    v([]), D(!1), b(C), (t = e.onClose) == null || t.call(e);
  }, onOpen: () => {
    var t;
    (t = e.onOpen) == null || t.call(e);
  }, content: ({ close: t }) => h(z, O(e, { get type() {
    return e.type || "single";
  }, get value() {
    var l, o;
    return ((o = (l = e.value) == null ? void 0 : l.call(e)) == null ? void 0 : o.value) || d().value;
  }, handleOnChange: A, get onChange() {
    return e.onChange;
  }, get maxDate() {
    return e.maxDate;
  }, get minDate() {
    return e.minDate;
  }, setAllowedComponents: v, close: t, setShowSelectorTwo: D, showSelectorTwo: T, setSelectorTwoProps: b, selectorTwoProps: Y })), onClickOutside: (t, l) => {
    var o;
    (o = R().concat(e.componentsToAllowOutsideClick || [])) != null && o.some((a) => {
      var r;
      return (r = a == null ? void 0 : a.contains) == null ? void 0 : r.call(a, t == null ? void 0 : t.target);
    }) || (l == null || l(!1));
  }, get positionX() {
    return e.pickerPositionX;
  }, get positionY() {
    return e.pickerPositionY;
  }, get zIndex() {
    return e.zIndex;
  }, handleChildrenClick: g ? () => {
  } : void 0, get width() {
    return e.inputWrapperWidth;
  }, get className() {
    return P(e.inputWrapperClass, "date-picker-input-wrapper");
  }, get children() {
    var t = G();
    return W(t, "data-date-picker-input-area", !0), k(t, h(I, { when: g, keyed: !0, children: g }), null), k(t, h(I, { when: !g, keyed: !0, get children() {
      var l = X();
      return $(l, O({ get placeholder() {
        return e.placeholder;
      }, get value() {
        var o, a, r;
        return ((o = e.inputLabel) == null ? void 0 : o.call(e)) || ((r = (a = e.value) == null ? void 0 : a.call(e)) == null ? void 0 : r.label) || d().label;
      } }, () => ({ ...e.inputProps, class: void 0 }), { get class() {
        var o;
        return P("date-picker-input rn-w-full rn-px-1", (o = e.inputProps) == null ? void 0 : o.class, e.inputClass);
      } }), !1, !1), l;
    } }), null), t;
  } });
};
export {
  U as DatePickerGroup
};
